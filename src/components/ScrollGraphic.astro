---
const {
  graphicSrc = "/graphics/sticker.svg",
  threshold = 0.5,
  alt = "Decorative graphic",
} = Astro.props;
---

<style>
  .container {
    position: relative;
  }

  .text-block {
    max-width: 600px;
    margin: 0 auto;
    padding: 3rem 1rem;
    background: white;
  }

  .floating-graphic {
    position: fixed;
    top: 50%;
    transform: translateY(-50%) translateX(-120%);
    transition: transform 0.4s ease;
    pointer-events: none;
    width: 240px;
    z-index: 30;
  }

  .floating-graphic.is-visible {
    transform: translateY(-50%) translateX(0);
  }
</style>

<div class="container">
  <!-- the thing we watch -->
  <section class="text-block" data-scroll-target>
    <slot />
  </section>

  <!-- the thing we animate -->
  <div class="floating-graphic" id="scroll-graphic">
    <img src={graphicSrc} alt={alt} loading="lazy" />
  </div>
</div>

<!-- this script needs to run in the browser -->
<script is:inline>
  // run after hydration
  if (typeof window !== "undefined") {
    const target = document.querySelector("[data-scroll-target]");
    const graphic = document.getElementById("scroll-graphic");

    if (target && graphic) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              graphic.classList.add("is-visible");
            } else {
              graphic.classList.remove("is-visible");
            }
          });
        },
        {
          root: null,
          threshold: Number({threshold}),
        }
      );

      observer.observe(target);
    }
  }
</script>